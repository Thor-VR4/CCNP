# IP
Лабараторное задание №4 по работе с IP.

## Задание
1. [Разработать и задокументировать адресное пространство для лабораторного стенда](#chapter-0)
2. [Настроить ip адреса на каждом активном порту](#chapter-1)
4. [Настроить каждый VPC в каждом офисе в своем VLAN](#chapter-2)
5. [Настроить VLAN управления для сетевых устройств](#chapter-3)
6. [Настроить сети офисов так, чтобы не возникало broadcast штормов, а использование линков было максимально оптимизировано](#chapter-4)

## Схема сети
![alt-текст](https://github.com/Thor-VR4/CCNA/blob/master/HomeWork/%234%20IP/IP.png "Стенд №4")

<a id="chapter-0"></a>
## Адресное пространство

Вся сеть была разделена на 5 зон, в соотвествии было распределение адресного пространства.
IPv4 адреса имеют общий вид 10.X.Y. где X указывает на зону, а Y на назначение подсети.
IPv6 адреса имеют общий префикс /48. Четвертый октет состоит из параметров XY, аналогичных IPv4. К примеру значение четвёртого октета, равное 0304, означает принадлежность к зоне СПБ и подсети роутеров.

Параметр | 0 | 1 | 2 | 3 | 4 |
--- | --- | --- | --- | --- | --- 
X | Москва | Ламас+Киторн | Триада+Лабытнанги | С.-Петербург | Чокурдах 
Y | Клиентская сеть 1 | Клиентская сеть 2 | Управление коммутаторов | Меж роутерные линки | Роутеры 

К примеру IP 10.0.2.4 - Интерфейс управления коммутатора SW4 в Москве.

<a id="chapter-1"></a>
## Таблица ip адресов на интерфейсах маршрутизаторов

Устройство | Порт | IPv4 | IPv6 GU | IPv6 LL
--- | --- | --- | --- | --- 
R12 | lo0 | 10.0.4.12/32 | 2A03:5A00:1F:4::12/128 | 
R12 | e0/0 | 10.0.3.1/30 |  | FE80::12
R12 | e0/1 | 10.0.3.5/30 |  | FE80::12
R12 | e0/2 | 10.0.3.13/30 |  | FE80::12
R12 | e0/3 | 10.0.3.9/30 |  | FE80::12
R13 | lo0 | 10.0.4.13/32 | 2A03:5A00:1F:4::13/128 |
R13 | e0/0 | 10.0.3.21/30 |  | FE80::13
R13 | e0/1 | 10.0.3.17/30 |  | FE80::13
R13 | e0/2 | 10.0.3.29/30 |  | FE80::13
R13 | e0/3 | 10.0.3.25/30 |  | FE80::13
R14 | lo0 | 10.0.4.14/32 | 2A03:5A00:1F:4::14/128 | 
R14 | e0/0 | 10.0.3.14/30 |  | FE80::14
R14 | e0/1 | 10.0.3.26/30 |  | FE80::14
R14 | e0/2 | 10.0.3.45/30 |  | FE80::14
R14 | e0/3 | 10.0.3.41/30 |  | FE80::14 
R15 | lo0 | 10.0.4.15/32 | 2A03:5A00:1F:4::15/128 | 
R15 | e0/0 | 10.0.3.30/30 |  | FE80::15 
R15 | e0/1 | 10.0.3.10/30 |  | FE80::15 
R15 | e0/2 | 10.0.3.37/30 |  | FE80::15
R15 | e0/3 | 10.0.3.33/30 |  | FE80::15
R19 | lo0 | 10.0.4.19/32 | 2A03:5A00:1F:4::19/128 | 
R19 | e0/0 | 10.0.3.42/30 |  | FE80::19
R20 | lo0 | 10.0.4.20/32 | 2A03:5A00:1F:4::20/128 | 
R20 | e0/0 | 10.0.3.34/30 |  | FE80::20
R21 | lo0 | 10.1.4.21/32 | 2A03:5A00:1F:104::21/128 | 
R21 | e0/0 | 10.0.3.38/30 |  | FE80::21
R21 | e0/1 | 10.1.3.1/30 |  | FE80::21
R21 | e0/2 | 10.2.3.6/30 |  | FE80::21 
R22 | lo0 | 10.1.4.22/32 | 2A03:5A00:1F:104::22/128 | 
R22 | e0/ | 10.0.3.46/30 |  | FE80::22
R22 | e0/ | 10.1.3.2/30 |  | FE80::22
R22 | e0/ | 10.2.3.14/30 |  | FE80::22 
R23 | lo0 | 10.2.4.23/32 | 2A03:5A00:1F:204::23/128 | 
R23 | e0/0 | 10.2.3.13/30 |  | FE80::23 
R23 | e0/1 | 10.2.3.17/30 |  | FE80::23
R23 | e0/2 | 10.2.3.10/30 |  | FE80::23
R24 | lo0 | 10.2.4.24/32 | 2A03:5A00:1F:204::24/128 | 
R24 | e0/0 | 10.2.3.5/30 |  | FE80::24
R24 | e0/1 | 10.2.3.2/30 |  | FE80::24
R24 | e0/2 | 10.2.3.9/30 |  | FE80::24
R24 | e0/3 | 10.3.3.30/30 |  | FE80::24  
R25 | lo0 | 10.2.4.25/32 | 2A03:5A00:1F:204::25/128 | 
R25 | e0/0 | 10.2.3.18/30 |  | FE80::25
R25 | e0/1 | 10.2.3.25/30 |  | FE80::25
R25 | e0/2 | 10.2.3.21/30 |  | FE80::25
R25 | e0/3 | 10.2.3.29/30 |  | FE80::25 
R26 | lo0 | 10.2.4.26/32 | 2A03:5A00:1F:204::26/128 | 
R26 | e0/0 | 10.2.3.1/30 |  | FE80::26
R26 | e0/1 | 10.2.3.33/30 |  | FE80::26 
R26 | e0/2 | 10.2.3.22/30 |  | FE80::26
R26 | e0/3 | 10.3.3.34/30 |  | FE80::26 
R27 | lo0 | 10.2.4.27/32 | 2A03:5A00:1F:204::27/128 | 
R27 | e0/0 | 10.2.3.26/30 |  | FE80::27
R16 | lo0 | 10.3.4.16/32 | 2A03:5A00:1F:304::16/128 | 
R16 | e0/0 | 10.3.3.1/30 |  | FE80::16
R16 | e0/1 | 10.3.3.13/30 |  | FE80::16 
R16 | e0/2 | 10.3.3.9/30 |  | FE80::16
R16 | e0/3 | 10.3.3.5/30 |  | FE80::16 
R17 | lo0 | 10.3.4.17/32 | 2A03:5A00:1F:304::17/128 | 
R17 | e0/0 | 10.3.3.17/30 |  | FE80::17 
R17 | e0/1 | 10.3.3.25/30 |  | FE80::17
R17 | e0/2 | 10.3.3.21/30 |  | FE80::17 
R18 | lo0 | 10.3.4.18/32 | 2A03:5A00:1F:304::18/128 | 
R18 | e0/0 | 10.3.3.14/30 |  | FE80::18
R18 | e0/1 | 10.3.3.26/30 |  | FE80::18
R18 | e0/2 | 10.3.3.29/30 |  | FE80::18
R18 | e0/3 | 10.3.3.33/30 |  | FE80::18  
R32 | lo0 | 10.3.4.32/32 | 2A03:5A00:1F:304::32/128 | 
R32 | e0/0 | 10.3.3.6/30 |  | FE80::32
R28 | lo0 | 10.4.4.28/32 | 2A03:5A00:1F:404::28/128 | 
R28 | e0/0 | 10.2.3.34/30 |  | FE80::28 
R28 | e0/1 | 10.2.3.30/30 |  | FE80::28
R28 | e0/2.10 | 10.4.2.1/24 | 2A03:5A00:1F:402::28/64 | FE80::28
R28 | e0/2.20 | 10.4.0.1/24 | 2A03:5A00:1F:400::1/64 | FE80::28
R28 | e0/2.21 | 10.4.1.1/24 | 2A03:5A00:1F:401::1/64 | FE80::28
SW4 | e1/0 | 10.0.3.2/30 |  | FE80::4
SW4 | e1/1 | 10.0.3.18/30 |  | FE80::4
SW4 | Vlan20 | 10.0.0.4/24 | 2A03:5A00:1F::4/64 | FE80::4
SW4 | Vlan21 | 10.0.1.4/24 | 2A03:5A00:1F:1::4/64 | FE80::4
SW5 | e1/0 | 10.0.3.22/30 |  | FE80::5
SW5 | e1/1 | 10.0.3.6/30 |  | FE80::5
SW5 | Vlan20 | 10.0.0.5/24 | 2A03:5A00:1F::5/64 | FE80::5
SW5 | Vlan21 | 10.0.1.5/24 | 2A03:5A00:1F:1::5/64 | FE80::5
SW9 | e0/3 | 10.3.3.18/30 |  | FE80::9
SW9 | e1/0 | 10.3.3.10/30 |  | FE80::9
SW9 | Vlan20 | 10.3.0.1/24 | 2A03:5A00:1F:300::1/64 | FE80::9
SW10 | e0/3 | 10.3.3.2/30 |  | FE80::10
SW10 | e1/0 | 10.3.3.22/30 |  | FE80::10
SW10 | Vlan21 | 10.3.1.1/24 | 2A03:5A00:1F:301::1/64 | FE80::10

<a id="chapter-2"></a>
## Настрока VPC в каждом офисе в своем VLAN

Для клиентов выделы два VLAN c номерами 20 и 21
Устройство | VLAN | IPv4 | IPv6 GU | IPv6 LL
--- | --- | --- | --- | --- 
VPC1 | 20 | 10.0.0.11/24 | 2a03:5a00:1f:0:2050:79ff:fe66:6801/64 | fe80::250:79ff:fe66:6801/64
VPC7 | 21 | 10.0.1.11/24 | 2a03:5a00:1f:1:2050:79ff:fe66:6807/64 | fe80::250:79ff:fe66:6807/64
VPC8 | 20 | 10.3.0.11/24 | 2a03:5a00:1f:300:2050:79ff:fe66:6808/64 | fe80::250:79ff:fe66:6808/64
VPC | 21 | 10.3.1.11/24 | 2a03:5a00:1f:301:2050:79ff:fe66:680b/64 | fe80::250:79ff:fe66:680b/64 
VPC30 | 20 | 10.4.0.30/24 | 2a03:5a00:1f:400:2050:79ff:fe66:681e/64 | fe80::250:79ff:fe66:681e/64
VPC31 | 21 | 10.4.1.31/24 | 2a03:5a00:1f:401:2050:79ff:fe66:681f/64 | fe80::250:79ff:fe66:681f/64

Для зон 0 и 3 настроена возможность получения адресов по DHCP. Для маршрутизации используется шлюз по умолчанию с первым адресом сети.
В IPv6 настроен метод SLAAC для получения адресов. В таблице указаны сгенерированные на текущий момент адреса.

<a id="chapter-3"></a>
## Настройка VLAN управления для сетевых устройств

Для коммутаторов выделен VLAN управления с номером 10 
Устройство | IPv4 | IPv6 GU | IPv6 LL
--- | --- | --- | --- 
SW4 | 10.0.2.4 | 2A03:5A00:1F:2::4/64 | FE80::4
SW5 | 10.0.2.5 | 2A03:5A00:1F:2::5/64 | FE80::5
SW9 | 10.3.2.9 | 2A03:5A00:1F:302::9/128 | FE80::9
SW10 | 10.3.2.10 | 2A03:5A00:1F:302::10/128 | FE80::10
SW2 | 10.0.2.2 | 2A03:5A00:1F:2::2/64 | FE80::2
SW3 | 10.0.2.3 | 2A03:5A00:1F:2::3/64 | FE80::3
SW29 | 10.4.2.29 | 2A03:5A00:1F:402::29/64 | FE80::29

Для возможности удаленного управления SW2-3 и SW29, на этих коммутаторах настроен шлюз по умолчанию с первым адресом сети управления.
Для резервирования этого шлюза в зоне Москва, был поднят hsrp домен на коммутаторах SW4-5.

<a id="chapter-4"></a>
## Настройка L2 сети и резервирование

На L2 уровне избыточность имеется в зонах Москва и С.-Петербург.
В С.-Петербурге был организован etherchannel между коммутаторами SW9-10
```
SW10#show etherchannel 1 summary 
Flags:  D - down        P - bundled in port-channel
        I - stand-alone s - suspended
        H - Hot-standby (LACP only)
        R - Layer3      S - Layer2
        U - in use      N - not in use, no aggregation
        f - failed to allocate aggregator

        M - not in use, minimum links not met
        m - not in use, port not aggregated due to minimum links not met
        u - unsuitable for bundling
        w - waiting to be aggregated
        d - default port

        A - formed by Auto LAG


Number of channel-groups in use: 1
Number of aggregators:           1

Group  Port-channel  Protocol    Ports
------+-------------+-----------+-----------------------------------------------
1      Po1(SU)         LACP      Et0/0(P)    Et0/1(P) 
```
В Москве так же был организован etherchannel. Для эффективного использования избыточных L2 каналов, настроено spaning-tree в режиме mst. Для разных групп вланов используются различные пути.
К примеру топология на SW2 для группы с vlan 21
```
MST21
  Spanning tree enabled protocol mstp
  Root ID    Priority    24597
             Address     aabb.cc00.4000
             Cost        1000
             Port        2 (Ethernet0/1)
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec

  Bridge ID  Priority    32789  (priority 32768 sys-id-ext 21)
             Address     aabb.cc00.2000
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec

Interface           Role Sts Cost      Prio.Nbr Type
------------------- ---- --- --------- -------- --------------------------------
Et0/0               Desg FWD 2000000   128.1    Shr 
Et0/1               Root FWD 1000      128.2    Shr 
Et0/2               Desg FWD 2000000   128.3    Shr Edge 
```
В результате клиентские vlan имеют по одному активному линку к каждому L3 коммутатору(SW4,5). В дополнение к этому на SW4 и SW5 реализовано резервирование шлюза по умолчанию с балансировкой нагрузки при помощи протокола glbp.
Состояние glbp группы для vlan 21 на SW5
```
Vlan21 - Group 21
  State is Active
    1 state change, last state change 06:37:19
  Virtual IP address is 10.0.1.1
  Hello time 3 sec, hold time 10 sec
    Next hello sent in 1.504 secs
  Redirect time 600 sec, forwarder timeout 14400 sec
  Preemption enabled, min delay 60 sec
  Active is local
  Standby is 10.0.1.4, priority 100 (expires in 9.376 sec)
  Priority 110 (configured)
  Weighting 100 (default 100), thresholds: lower 1, upper 100
  Load balancing: round-robin
  Group members:
    aabb.cc80.4000 (10.0.1.4)
    aabb.cc80.5000 (10.0.1.5) local
  There are 2 forwarders (1 active)
  Forwarder 1
    State is Listen
      4 state changes, last state change 06:35:37
    MAC address is 0007.b400.1501 (learnt)
    Owner ID is aabb.cc80.4000
    Redirection enabled, 599.392 sec remaining (maximum 600 sec)
    Time to live: 14399.392 sec (maximum 14400 sec)
    Preemption enabled, min delay 30 sec
    Active is 10.0.1.4 (primary), weighting 100 (expires in 10.688 sec)
    Client selection count: 1
  Forwarder 2
    State is Active
      1 state change, last state change 06:36:14
    MAC address is 0007.b400.1502 (default)
    Owner ID is aabb.cc80.5000
    Redirection enabled
    Preemption enabled, min delay 30 sec
    Active is local, weighting 100
    Client selection count: 1
```
В IPv6 для резервирования шлюза по умолчанию и распределения трафика в клиентских vlan на коммутаторах SW4 и SW5 настроен различный приоритет в сообщениях RA.